{% extends "storefront_base.html" %}

{% block title %}Support Messages - AuroraMart{% endblock %}

{% block page_content %}
<!-- Quick help banner -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-8">
    <div class="bg-cyan/10 border border-cyan/20 rounded-lg p-3 flex items-center justify-between">
        <div>
            <p class="text-sm font-medium text-foreground">Need quick help? Ask Aurora instantly.</p>
            <p class="text-xs text-muted-foreground">Get an instant answer from our chat assistant.</p>
        </div>
        <div>
            <a href="{% url 'storefront:aurora_chatbot' %}" class="inline-flex items-center gap-2 px-6 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors whitespace-nowrap">
                <i data-lucide="bot" class="w-4 h-4"></i>
                Ask Aurora
            </a>
        </div>
    </div>
</div>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    
    <!-- Page Header -->
    <div class="flex items-center justify-between mb-8">
        <div>
            <h1 class="text-3xl font-bold text-foreground mb-2">Support Messages</h1>
            <p class="text-muted-foreground">View and manage your support conversations</p>
        </div>
        <div class="flex items-center gap-4">
            <a href="{% url 'storefront:chat_create' %}" 
               class="px-6 py-3 bg-cyan text-white font-medium rounded-lg hover:bg-cyan/90 transition-colors flex items-center gap-2">
                <i data-lucide="message-square-plus" class="w-5 h-5"></i>
                Start New Chat
            </a>
        </div>
    </div>

    {% if chat_sessions %}
    <div class="space-y-4">
        {% for session in chat_sessions %}
        <a href="{% url 'storefront:chat_detail' session.id %}" 
           class="block bg-card border border-border rounded-lg p-6 hover:shadow-lg transition-all hover:border-cyan">
            <div class="flex items-center justify-between">
                <div class="flex-1">
                    <div class="flex items-center gap-3 mb-2">
                        <h3 class="text-lg font-semibold text-foreground">{{ session.subject }}</h3>
                        {% if session.status == 'open' %}
                            <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-700 font-medium">
                                <i data-lucide="circle" class="w-2 h-2 inline-block fill-current"></i> Open
                            </span>
                        {% else %}
                            <span class="px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-700 font-medium">
                                <i data-lucide="check-circle" class="w-3 h-3 inline-block"></i> Closed
                            </span>
                        {% endif %}
                        {% if session.unread_count > 0 %}
                            <span class="px-2 py-1 text-xs rounded-full bg-cyan text-white font-bold">
                                {{ session.unread_count }} new
                            </span>
                        {% endif %}
                    </div>
                    {% if session.order %}
                    <p class="text-sm text-muted-foreground mb-2">
                        <i data-lucide="package" class="w-4 h-4 inline-block"></i>
                        Related to Order #{{ session.order.id }}
                    </p>
                    {% endif %}
                    <p class="text-sm text-muted-foreground">
                        Created: {{ session.created_at|date:"M d, Y g:i A" }} â€¢ 
                        Last updated: {{ session.updated_at|date:"M d, Y g:i A" }}
                    </p>
                    {% if session.messages.first %}
                    <p class="text-sm text-muted-foreground mt-2 line-clamp-1">
                        {{ session.messages.first.message|truncatewords:20 }}
                    </p>
                    {% endif %}
                </div>
                <div class="ml-4">
                    <i data-lucide="chevron-right" class="w-5 h-5 text-muted-foreground"></i>
                </div>
            </div>
        </a>
        {% endfor %}
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="bg-card border border-border rounded-lg p-12 text-center">
        <i data-lucide="message-square" class="w-16 h-16 text-muted-foreground mx-auto mb-4"></i>
        <h3 class="text-lg font-medium text-foreground mb-2">No Messages Yet</h3>
        <p class="text-sm text-muted-foreground mb-6">Start a conversation with our support team</p>
        <a href="{% url 'storefront:chat_create' %}" 
           class="inline-flex items-center gap-2 px-6 py-3 bg-cyan text-white font-medium rounded-lg hover:bg-cyan/90 transition-colors">
            <i data-lucide="message-square-plus" class="w-5 h-5"></i>
            New Message
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}

