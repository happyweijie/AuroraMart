{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="min-h-screen flex flex-col">
    <!-- Top Navigation Bar -->
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center gap-3">
                    <img src="{% static 'logo.png' %}" alt="AuroraMart Logo" class="w-14 h-14 object-contain">
                    <a href="{% url 'storefront:home' %}" class="text-xl font-bold" style="color: #1e3a5f;">AuroraMart</a>
                </div>
                
                <!-- Search Bar -->
                <div class="flex-1 max-w-2xl mx-8">
                    <form action="{% url 'storefront:products' %}" method="get" class="relative">
                        <input type="search" 
                               autocomplete="off"
                               name="q"
                               value="{{ search_query|default:'' }}"
                               placeholder="Search products..." 
                               class="w-full px-4 py-2 pl-10 pr-4 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-cyan focus:border-transparent">
                        <button type="submit" class="absolute left-3 top-2.5">
                            <i data-lucide="search" class="w-5 h-5 text-muted-foreground"></i>
                        </button>
                    </form>
                </div>
                
                <!-- Navigation Icons -->
                <div class="flex items-center gap-4">
                    <!-- Flash Sale Button (only show if there are active flash sales) -->
                    {% if active_flash_sales %}
                    <a href="{% url 'storefront:flash_sale_products' %}" 
                       class="p-2 hover:bg-gray-100 rounded-lg relative group"
                       title="View All Flash Sales">
                        <i data-lucide="flame" class="w-5 h-5 text-orange-500"></i>
                    </a>
                    {% endif %}
                    
                    {% if user.is_authenticated %}
                        <!-- Watchlist -->
                        <a href="{% url 'storefront:watchlist' %}" class="p-2 hover:bg-gray-100 rounded-lg relative">
                            <i data-lucide="heart" class="w-5 h-5 text-foreground"></i>
                            {% if watchlist_count > 0 %}
                            <span class="absolute top-0 right-0 w-4 h-4 bg-cyan text-white text-xs rounded-full flex items-center justify-center font-medium">{{ watchlist_count }}</span>
                            {% endif %}
                        </a>
                        
                        <!-- Cart -->
                        <a href="{% url 'storefront:cart' %}" class="p-2 hover:bg-gray-100 rounded-lg relative">
                            <i data-lucide="shopping-cart" class="w-5 h-5 text-foreground"></i>
                            {% if cart_item_count > 0 %}
                            <span class="absolute top-0 right-0 w-5 h-5 bg-cyan text-white text-xs rounded-full flex items-center justify-center font-medium">{{ cart_item_count }}</span>
                            {% endif %}
                        </a>
                        
                        <!-- HelpBot -->
                        <a href="#" class="p-2 hover:bg-gray-100 rounded-lg relative" title="Help Bot">
                            <i data-lucide="bot" class="w-6 h-6 text-foreground"></i>
                        </a>

                        <!-- User Menu -->
                        <div class="relative" x-data="{ open: false }" @click.away="open = false"> {# Added Alpine.js x-data and click.away #}
                            <button @click="open = !open" class="flex items-center gap-2 p-2 hover:bg-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan focus:ring-opacity-50">
                                <div class="w-8 h-8 bg-gradient-to-br from-cyan to-purple-500 rounded-full flex items-center justify-center">
                                    <span class="text-white text-sm font-medium">{{ user.first_name.0|default:'U' }}</span>
                                </div>
                                <span class="text-sm font-medium text-foreground">{{ user.first_name|default:'User' }}</span>
                                <i data-lucide="chevron-down" class="w-4 h-4 text-muted-foreground transition-transform duration-200" :class="{ 'rotate-180': open }"></i>
                            </button>

                            {# Dropdown Menu #}
                            <div x-show="open"
                                x-transition:enter="transition ease-out duration-100"
                                x-transition:enter-start="transform opacity-0 scale-95"
                                x-transition:enter-end="transform opacity-100 scale-100"
                                x-transition:leave="transition ease-in duration-75"
                                x-transition:leave-start="transform opacity-100 scale-100"
                                x-transition:leave-end="transform opacity-0 scale-95"
                                x-cloak
                                class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 ring-1 ring-black ring-opacity-5 z-50"
                                style="display: none;">
                                
                                <a href="{% url 'users:profile' %}" class="block px-4 py-2 text-sm text-foreground hover:bg-gray-100">
                                    <i data-lucide="user" class="inline-block w-4 h-4 mr-2 text-muted-foreground"></i>
                                    Profile
                                </a>
                                
                                <a href="{% url 'storefront:order_list' %}" class="block px-4 py-2 text-sm text-foreground hover:bg-gray-100">
                                    <i data-lucide="package" class="inline-block w-4 h-4 mr-2 text-muted-foreground"></i>
                                    My Orders
                                </a>
                                
                                <a href="{% url 'storefront:review_list' %}" class="block px-4 py-2 text-sm text-foreground hover:bg-gray-100">
                                    <i data-lucide="message-square" class="inline-block w-4 h-4 mr-2 text-muted-foreground"></i>
                                    My Reviews
                                </a>
                                
                                <a href="{% url 'storefront:chat_list' %}" class="block px-4 py-2 text-sm text-foreground hover:bg-gray-100">
                                    <i data-lucide="message-circle" class="inline-block w-4 h-4 mr-2 text-muted-foreground"></i>
                                    Support Chat
                                </a>

                                <a href="#" class="block px-4 py-2 text-sm text-foreground hover:bg-gray-100">
                                    <i data-lucide="bot" class="inline-block w-4 h-4 mr-2 text-muted-foreground"></i>
                                    Ask Aurora
                                </a>
                                
                                {# Separator #}
                                <div class="border-t border-gray-100 my-1"></div>

                                {# Logout Button #}
                                <a href="{% url 'users:logout' %}" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50">
                                    <i data-lucide="log-out" class="inline-block w-4 h-4 mr-2"></i>
                                    Logout
                                </a>
                            </div>
                        </div>
                    {% else %}
                        <!-- Cart for Guest Users -->
                        <a href="{% url 'storefront:cart' %}" class="p-2 hover:bg-gray-100 rounded-lg relative">
                            <i data-lucide="shopping-cart" class="w-5 h-5 text-foreground"></i>
                            {% if cart_item_count > 0 %}
                            <span class="absolute top-0 right-0 w-5 h-5 bg-cyan text-white text-xs rounded-full flex items-center justify-center font-medium">{{ cart_item_count }}</span>
                            {% endif %}
                        </a>
                        
                        <a href="{% url 'users:login' %}" class="px-4 py-2 text-sm font-medium text-foreground hover:bg-gray-100 rounded-lg">
                            Sign In
                        </a>
                        <a href="{% url 'users:register' %}" class="px-4 py-2 text-sm font-medium text-white bg-cyan hover:bg-cyan/90 rounded-lg">
                            Sign Up
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Category Navigation (moved to top, right after main nav) -->
    <div class="bg-white border-b border-gray-200 sticky top-16 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center gap-6 h-12 overflow-x-auto">
                <a href="{% url 'storefront:products' %}" 
                   class="text-sm font-medium whitespace-nowrap transition-all
                          {% if not current_category_slug %}text-cyan font-semibold border-b-2 border-cyan{% else %}text-muted-foreground hover:text-cyan{% endif %}">
                    All Products
                </a>
                {% if nav_categories %}
                    {% for category in nav_categories %}
                    <a href="{% url 'storefront:category' category.slug %}" 
                       class="text-sm font-medium whitespace-nowrap transition-all
                              {% if current_category_slug == category.slug %}
                              text-cyan font-semibold border-b-2 border-cyan
                              {% else %}
                              text-muted-foreground hover:text-cyan
                              {% endif %}">
                        {{ category.name }}
                    </a>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <main class="flex-1 bg-background">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            {% block page_content %}
            {% endblock %}
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="bg-primary text-primary-foreground mt-auto">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex items-center justify-between text-sm text-gray-400">
                <p>&copy; 2025 AuroraMart. All rights reserved.</p>
                
                <!-- Admin Access Icon -->
                {% if user.is_staff %}
                    <a href="{% url 'admin_panel:dashboard' %}" 
                       class="flex items-center gap-2 px-3 py-2 bg-gradient-to-br from-cyan to-purple-500 text-white rounded-lg hover:opacity-90 transition-opacity"
                       title="Admin Panel">
                        <i data-lucide="shield" class="w-4 h-4"></i>
                        <span class="text-xs font-medium">Admin Panel</span>
                    </a>
                {% else %}
                    <a href="{% url 'admin_panel:admin_login' %}" 
                       class="flex items-center gap-2 px-3 py-2 bg-sidebar hover:bg-sidebar-accent text-sidebar-foreground rounded-lg transition-colors"
                       title="Admin Login">
                        <i data-lucide="shield" class="w-4 h-4"></i>
                        <span class="text-xs font-medium">Admin Login</span>
                    </a>
                {% endif %}
            </div>
        </div>
    </footer>
</div>
{% endblock %}
